<mvc:View
    controllerName="ns.visits.controller.Detail"
    xmlns:mvc="sap.ui.core.mvc"
    xmlns="sap.m"
    displayBlock="true"
    height="100%"
    busyIndicatorDelay="0"
    xmlns:l="sap.ui.layout"
    xmlns:f="sap.ui.layout.form"
    xmlns:core="sap.ui.core"
>
    <Page
        id="idPage"
        title="{i18n>title}"
        showNavButton="true"
        navButtonPress=".onPageNavButtonPress"
        
    >
        <content>
            <ObjectHeader
                id="idObjectHeader"
                title="{visitDate}"
                number="{status/name}"
                icon="sap-icon://appointment"
                responsive="true"
            >
                <attributes>
                    <ObjectAttribute text="Location: {location/name}" />
                    <ObjectAttribute text="Space: {spaces/name}" />
                </attributes>
            </ObjectHeader>
        </content>
        <l:VerticalLayout
            class="sapUiContentPadding sapUiResponsiveMargin"
            enabled="{view>/isEditable}"
            width="50%"
        >
            <IconTabBar
                id="IconTabBarId"
                select=".onSelectIconTabBar"
                class="myCustomTabBar"
            >
                <items>
                    <IconTabFilter
                        key="Main"
                        text="Main"
                    >
                        <f:SimpleForm
                        
                            id="idSimpleForm"
                            editable="true"
                            layout="ResponsiveGridLayout"
                           
                            
                            
                        >
                            <Label text="{i18n>visitDateInputText}" />
                            <DatePicker
                                id="visitDatePicker"
                                class="sapUiMediumMarginBeginEnd"
                                value="{visitDate}"
                                displayFormat="yyyy-MM-dd"
                                change="onDateChange"
                                placeholder="Select Visit Date"
                                width="95%"
                            />
                            <Label text="{i18n>statusText}" />
                            <ComboBox
                                width="95%"
                                id="idStatusComboBox"
                                items="{
                       path: '/Status',
                       sorter: { path: 'name' }
                    }"
                                change="onSelectStatusChange"
                                class="sapUiMediumMarginBegin"
                                selectedKey="{ path: 'statusID', type: 'sap.ui.model.type.String' }"
                            >
                                <core:Item
                                    key="{ID}"
                                    text="{name}"
                                />
                            </ComboBox>

                            <Label text="{i18n>contactText}" />
                            <Input
                                id="idContactInput"
                                value="{contact}"
                                class="sapUiMediumMarginBeginEnd"
                                width="95%"
                            />

                            <Label text="{i18n>purposeText}" />
                            <Input
                                id="idPurposeInput"
                                value="{purpose}"
                                class="sapUiMediumMarginBeginEnd"
                                width="95%"
                            />

                            <Label text="{i18n>locationText}" />
                            <ComboBox
                                id="idLocationComboBox"
                                width="95%"
                                items="{/Location}"
                                selectedKey="{ path: 'locationID', type: 'sap.ui.model.type.String' }"
                                selectionChange="onLocationSelectionChange"
                                class="sapUiMediumMarginBegin"
                            >
                                <core:Item
                                    key="{ID}"
                                    text="{name}"
                                />
                            </ComboBox>

                            <Label text="{i18n>descriptionText}" />
                            <Input
                                id="idDescriptionInput"
                                value="{description}"
                                class="sapUiMediumMarginBeginEnd"
                                width="95%"
                            />
                            <Label text="{i18n>spacesText}" />
                            <ComboBox
                                id="idSpaceComboBox"
                                width="95%"
                                items="{/Spaces}"
                                selectedKey="{ path: 'spaceID', type: 'sap.ui.model.type.String' }"
                                change="onSpaceSelectionChange"
                                class="sapUiMediumMarginBegin"
                            >
                                <core:Item
                                    key="{ID}"
                                    text="{name}"
                                />
                            </ComboBox>
                        </f:SimpleForm>
                        <Table
                            id="idVisitorsTable"
                            items="{
                            path: 'visitors',
                                 parameters: {
                              $expand: 'visitor'}
                            }"
                            itemPress="onVisitorPress"
                          
                        >
                            <headerToolbar>
                                <Toolbar>
                                    <Title
                                        id="idVisitorsTitle"
                                        text="{i18n>Visitors}"
                                    />
                                    <ToolbarSpacer />
                                    <Button
                                        text="Add Visitor"
                                        id="idButtonButton"
                                        press="onButtonButtonPress"
                                        type="Emphasized"
                                    />
                                    <SearchField
                                        id="idVisitorSearchField"
                                        placeholder="Search All Columns"
                                        search=".onSearchVisitor"
                                        width="50%"
                                    />
                                </Toolbar>
                            </headerToolbar>

                            <columns>
                                <Column
                                    hAlign="Left"
                                    minScreenWidth="Small"
                                    demandPopin="true"
                                >
                                    <Text text="{i18n>VisitorID}" />
                                </Column>
                                <Column
                                    hAlign="Left"
                                    minScreenWidth="Small"
                                    demandPopin="true"
                                >
                                    <Text text="{i18n>VisitorName}" />
                                </Column>
                                <Column
                                    hAlign="Left"
                                    minScreenWidth="Small"
                                    demandPopin="true"
                                >
                                    <Text text="{i18n>visitorEmail}" />
                                </Column>
                                <Column
                                    hAlign="Left"
                                    minScreenWidth="Small"
                                    demandPopin="true"
                                >
                                    <Text text="{i18n>visitorPhoneNumber}" />
                                </Column>
                                <Column
                                    hAlign="Left"
                                    minScreenWidth="Small"
                                    demandPopin="true"
                                >
                                    <Text text="{i18n>visitorCountry}" />
                                </Column>
                                <Column
                                    hAlign="Left"
                                    minScreenWidth="Small"
                                    demandPopin="true"
                                >
                                    <Text text="{i18n>visitorStreet}" />
                                </Column>
                                <Column
                                    hAlign="Left"
                                    minScreenWidth="Small"
                                    demandPopin="true"
                                >
                                    <Text text="{i18n>visitorPostalCode}" />
                                </Column>
                                <Column
                                    hAlign="Left"
                                    minScreenWidth="Small"
                                    demandPopin="true"
                                >
                                    <Text text="{i18n>visitorCompany}" />
                                </Column>
                            </columns>

                            <items>
                                <ColumnListItem>
                                    <cells>
                                        <ObjectNumber
                                            number="{visitor/ID}"
                                            emphasized="false"
                                        />
                                        <Text text="{visitor/name}" />
                                        <Text text="{visitor/email}" />
                                        <Text text="{visitor/phone}" />
                                        <Text text="{visitor/country}" />
                                        <Text text="{visitor/street}" />
                                        <Text text="{visitor/postal_code}" />
                                        <Text text="{visitor/company}" />
                                    </cells>
                                </ColumnListItem>
                            </items>
                        </Table>
                    </IconTabFilter>
                    <IconTabFilter
                        key="Agenda"
                        text="Agenda"
                    >
                        <Table
                            id="idAgendaTable"
                            items="{path: 'agenda'}"
                            selectionChange=".onSelectionChange"
                            mode="MultiSelect"
                        >
                            <headerToolbar>
                                <OverflowToolbar id="otbSubheader">
                                    <content>
                                        <Title
                                            text="Agenda and Result"
                                            level="H2"
                                        />
                                        <ToolbarSpacer />
                                        <Button
                                            id="editButton"
                                            text="Edit"
                                            type="Transparent"
                                            press="onEdit"
                                            icon="sap-icon://edit"
                                        />
                                        <Button
                                            id="addRow"
                                            press="onAdd"
                                            text="Add Row"
                                        />
                                        <Button
                                            id="saveButton"
                                            text="Save"
                                            type="Transparent"
                                            press="onSave"
                                            visible="false"
                                        />
                                        <Button
                                            id="cancelButton"
                                            text="Cancel"
                                            type="Transparent"
                                            press="onCancel"
                                            visible="false"
                                        />
                                        <Button
                                            id="deleteButton"
                                            text="Delete"
                                            type="Transparent"
                                            press="onDelete"
                                            icon="sap-icon://delete"
                                            enabled="{view>/isDeleteEnabled}"
                                        />
                                    </content>
                                </OverflowToolbar>
                            </headerToolbar>

                            <columns>
                                <Column width="12em">
                                    <Text text="Visitor" />
                                </Column>
                                <Column width="12em">
                                    <Text text="Topic" />
                                </Column>
                                <Column width="12em">
                                    <Text text="Description" />
                                </Column>
                                <Column width="12em">
                                    <Text text="Outcome" />
                                </Column>
                            </columns>

                            <items>
                                <ColumnListItem>
                                    <cells>
                                        <ComboBox
                                            items="{path: 'visits/visitors'}"
                                            selectedKey="{agenda>visitorID}"
                                            editable="false"
                                        >
                                            <core:Item
                                                key="{visitorID}"
                                                text="{visitor/name}"
                                            />
                                        </ComboBox>

                                        <ComboBox
                                            items="{topics>/Topics}"
                                            selectedKey="{agenda>topic}"
                                            editable="false"
                                        >
                                            <core:Item
                                                key="{topics>ID}"
                                                text="{topics>name}"
                                            />
                                        </ComboBox>

                                        <Input
                                            value="{agenda>description}"
                                            editable="false"
                                            placeholder="Enter description"
                                        />

                                        <Input
                                            value="{agenda>outcome}"
                                            editable="false"
                                            placeholder="Enter outcome"
                                        />
                                    </cells>
                                </ColumnListItem>
                            </items>
                        </Table>
                    </IconTabFilter>
                    <IconTabFilter
                        key="Rating"
                        text="Rating"
                    >
                        <l:VerticalLayout>
                            <Label
                                text="{i18n>Rate}"
                                labelFor="RI_S"
                            />
                            <TextArea id="feedbackId" />
                            <Button
                                id="fbbuttonId"
                                text="Send"
                                press="onSendFB"
                            />
                            <RatingIndicator
                                id="idRatingRatingIndicator"
                                value="{/rating}"
                                iconSize="22px"
                                liveChange=".onRatingChange"
                                tooltip="Rating Tooltip"
                            />
                            <List
                                id="feedbackList"
                                items="{path: 'feedback'}"
                                class="sapUiSmallMarginTop"
                            >
                                <items>
                                    <CustomListItem>
                                        <HBox>
                                            <VBox>
                                                <Text text="{feedback}" />
                                                <RatingIndicator
                                                    value="{rating}"
                                                    maxValue="5"
                                                    editable="false"
                                                />
                                            </VBox>
                                        </HBox>
                                    </CustomListItem>
                                </items>
                            </List>
                        </l:VerticalLayout>
                    </IconTabFilter>
                </items>
            </IconTabBar>
        </l:VerticalLayout>
        <footer>
            <Bar>
                <contentRight>
                    <Button
                        text="save"
                        press="onSaveButtonPress"
                        type="Emphasized"
                    />
                    <Button
                        text="{
                            path: 'view>/isEditable',
                            formatter: '.formatToggleButtonText'
                        }"
                        press=".onIsEditableButtonPress"
                    />
                </contentRight>
            </Bar>
        </footer>
    </Page>
</mvc:View>
